---
title: 【Next】链接和导航
date: 2024-02-22
sidebar: 'auto'
categories:
 - Next
tags:
 - Next
publish: true
---

## 前言
在Next.js中，有四种导航方式，分别是`<Link />`组件，`useRouter`（客户端组件），`redirect`(服务器组件)，`History API`本机历史。

## `<Link>`
### 基础使用
再之前的例子中已经应用过Link了，现在学习下链接到动态段。举个栗子：
修改`app/user/layout.jsx`
```jsx {6-19,22-28}
"use client";
import {useState} from "react";
import Link from "next/link";
export default function UserLayout({children}) {
	const [count, setCount] = useState(0);
	const arr = [
		{
			name: "center",
			url: "center",
		},
		{
			name: "config",
			url: "config",
		},
		{
			name: "detail",
			url: "detail",
		},
	];
	return (
		<div>
			<ul>
				{arr.map((item) => (
					<li key={item.url}>
						<Link href={`/user/${item.url}`}>{item.name}</Link>
					</li>
				))}
			</ul>
			<h2>这是User布局 count: {count}</h2>
			<button onClick={() => setCount(count + 1)}>加</button>
			<div>{children}</div>
		</div>
	);
}
```
打开地址`http://localhost:3000/user/center`
<img :src="$withBase('/imgs/0_2_NextJS/link/link1.jpg')" alt=""><br/>
点击链接即可切换导航

### 获取活动链接（usePathname）
采用`usePathname`可以用来获取处于活跃状态的链接
修改`app/user/layout.jsx`
```jsx {3,7,28,29}
"use client";
import {useState} from "react";
import {usePathname} from "next/navigation";
import Link from "next/link";
export default function UserLayout({children}) {
	const [count, setCount] = useState(0);
	const pathName = usePathname();
	const arr = [
		{
			name: "center",
			url: "center",
		},
		{
			name: "config",
			url: "config",
		},
		{
			name: "detail",
			url: "detail",
		},
	];
	return (
		<div>
			<ul>
				{arr.map((item) => (
					<li key={item.url}>
						<Link
							style={{
								color: pathName === "/user/" + item.url ? "red" : "black",
							}}
							href={`/user/${item.url}`}
						>
							{item.name}
						</Link>
					</li>
				))}
			</ul>
			<h2>这是User布局 count: {count}</h2>
			<button onClick={() => setCount(count + 1)}>加</button>
			<div>{children}</div>
		</div>
	);
}
```
打开地址`http://localhost:3000/user/detail`
<img :src="$withBase('/imgs/0_2_NextJS/link/link2.jpg')" alt=""><br/>
发现detail是红色，点击切换路由，发现对应的当前路由一一变红

### 跳转并滚动
可以根据hash值进行锚点跳转，比如
修改`app/user/layout.jsx`
```jsx {12}
"use client";
import {useState} from "react";
import {usePathname} from "next/navigation";
import Link from "next/link";
export default function UserLayout({children}) {
	const [count, setCount] = useState(0);
	const pathName = usePathname();
	console.log(pathName);
	const arr = [
		{
			name: "center",
			url: "center#3",
		},
		{
			name: "config",
			url: "config",
		},
		{
			name: "detail",
			url: "detail",
		},
	];
	return (
		<div>
			<ul>
				{arr.map((item) => (
					<li key={item.url}>
						<Link
							style={{
								color: pathName === "/user/" + item.url ? "red" : "black",
							}}
							href={`/user/${item.url}`}
						>
							{item.name}
						</Link>
					</li>
				))}
			</ul>
			<h2>这是User布局 count: {count}</h2>
			<button onClick={() => setCount(count + 1)}>加</button>
			<div>{children}</div>
		</div>
	);
}
```
修改`app/user/center/page.jsx`
```jsx {9}
"use client";
import {useState} from "react";
export default function Page() {
	const [arr, setArr] = useState([1, 2, 3, 4]);
	return (
		<div>
			<h2>这是center页面</h2>
			{arr.map((item) => (
				<p id={item} style={{height: 800, border: "1px solid red"}} key={item}>
					{item}
				</p>
			))}
			<button
				onClick={() => {
					setArr(true);
				}}
			>
				制造错误
			</button>
		</div>
	);
}
```
点击center路由
<img :src="$withBase('/imgs/0_2_NextJS/link/link3.jpg')" alt=""><br/>

### 禁用默认行为
Next.js APP Router的默认行为切换路由会滚动到新路由的顶部或者是保持滚动位置以进行向前或者向后导航。这种行为可以有两种方式禁止。其一是`<Link href={} scroll={false}><link/>`，其二是在`router.push(url, { scroll: false })`或者`router.replace(url, { scroll: false })`。
修改`app/user/center.page.jsx`
```jsx {2-3,23-34}
"use client";
import {useState} from "react";
import Link from "next/link";
import {useRouter} from "next/navigation";
export default function Page() {
	const [arr, setArr] = useState([1, 2, 3, 4]);
	const router = useRouter();
	return (
		<div>
			<h2>这是center页面</h2>
			{arr.map((item) => (
				<p id={item} style={{height: 800, border: "1px solid red"}} key={item}>
					{item}
				</p>
			))}
			<button
				onClick={() => {
					setArr(true);
				}}
			>
				制造错误
			</button>
			<button>
				<Link href="/user/config" scroll={false}>
					Link跳转
				</Link>
			</button>
			<button
				onClick={() => {
					router.push("/user/config");
				}}
			>
				router跳转
			</button>
		</div>
	);
}
```
修改`app/user/config.jsx`
```jsx {1-2,4,8-17}
"use client";
import {useState} from "react";
export default function Page() {
	const [arr, setArr] = useState([1, 2, 3, 4]);
	return (
		<div>
			<h2>这是config页面</h2>
			{arr &&
				arr.map((item) => (
					<p
						id={item}
						style={{height: 800, border: "1px solid red"}}
						key={item}
					>
						{item}
					</p>
				))}
		</div>
	);
}
```
打开地址`(http://localhost:3000/user/center#4)`，分别点击下面的Link跳转，和router跳转
<img :src="$withBase('/imgs/0_2_NextJS/link/link4.jpg')" alt=""><br/>
<img :src="$withBase('/imgs/0_2_NextJS/link/link5.jpg')" alt=""><br/>
发现带有`scroll={false}`的不会记录位置

## useRouter
在Next中用户更改路由的hook
::: warning
这是一个用在客户端组件中的hook，注意顶层`use client`
:::
<img :src="$withBase('/imgs/0_2_NextJS/link/link4.jpg')" alt=""><br/>
新增`useRouter/page.jsx`文件
```jsx
export default function Page() {
	return (
		<div>
			<h1>useRouterPage</h1>
		</div>
	);
}
```
新增`useRouter/layout.jsx`文件
```jsx
"use client";
import {useRouter} from "next/navigation";

export default function UseRouterLayout({children}) {
	const router = useRouter();
	return (
		<div>
			<h1>这是UseRouter布局</h1>
			<button onClick={() => router.push("/user/detail")}>router.push</button>
			<button onClick={() => router.replace("/user/detail")}>
				router.replace
			</button>
			<button onClick={() => router.refresh()}>router.refresh</button>
			<button onClick={() => router.prefetch("/user/detail")}>
				router.prefetch
			</button>
			<button onClick={() => router.back()}>router.back</button>
			<button onClick={() => router.forward()}>router.forward</button>
			<div>{children}</div>
		</div>
	);
}
```
+ router.push(href: string, { scroll: boolean }) 执行客户端导航到提供的url，在浏览器历史记录中添加新的条目
+ router.replace(href: string, { scroll: boolean }) 执行客户端导航到提供的url，不会在浏览器历史记录中添加新的条目
+ router.refresh 刷新当前路由，但是并不会丢失客户端react的状态或者浏览器的状态
+ router.back 返回到浏览器历史中的上一项
+ router.forward 跳转到浏览器历史中的下一项
+ router.prefetch(href: string) 预加载提供的url，加快客户端响应速度