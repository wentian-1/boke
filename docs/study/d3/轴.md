---
title: 【D3】轴
date: 2025-05-16
sidebar: 'auto'
categories:
 - D3
tags:
 - D3
publish: true
---

## 轴
轴组件一般是一个g元素，在g元素里面调用轴组件来填充轴，轴组件会渲染在原点（因为d3是围绕svg展开的，所以坐标系也是svg的，所以原点在容器左上角，x轴正方向右，y轴正方向向下）

轴的创建必须要包含比例尺，这个属性定义了轴是从多少到多少以及位置。以线性比例尺为例
```js
const xScale = d3.scaleLinear([0, 100], [20, 780])
```
这句代码`scaleLinear`是线性的坐标轴（当然还有其余的，此处以线性为例）参数的第一个数组代表的是x轴刻度的起止范围,第二个数组代表的是比例尺的位置是从哪开始到哪结束。具体效果从下面的轴为例开始

### axisTop
`axisTop`是代表轴线在下方，刻度以及文字在上方的轴。
```js
mySvg.append("g").call(d3.axisTop(xScale));
```
在浏览器面打开如下图所示
<img :src="$withBase('/imgs/d3/轴/1.png')" alt=""><br/>
此时只能看到一条线，因为我们坐标是从0，0开始的，所以线的上面被遮盖了，所以看不到，如果想看到将轴所在`g`元素的位置下移。

```js
mySvg.append("g").call(d3.axisTop(xScale)).attr("transform", `translate(0,20)`);
```
此时就可以看到完整的坐标轴了。
<img :src="$withBase('/imgs/d3/轴/2.png')" alt=""><br/>

### axisBottom
`axisTop`是代表轴线在上方，刻度以及文字在下方的轴。

```js
const xAxis2 = mySvg.append("g").call(d3.axisBottom(xScale)).attr("transform", `translate(0,40)`);
```
<img :src="$withBase('/imgs/d3/轴/3.png')" alt=""><br/>

### axisLeft
`axisLeft`是代表轴线在右方，刻度以及文字在左方的轴。

```js
mySvg.append("g").call(d3.axisLeft(xScale)).attr("transform", `translate(20 60)`);
```
<img :src="$withBase('/imgs/d3/轴/4.png')" alt=""><br/>

### axisRight
`axisRight`是代表轴线在左方，刻度以及文字在右方的轴。

```js
mySvg.append("g").call(d3.axisRight(xScale)).attr("transform", `translate(760 60)`);
```
<img :src="$withBase('/imgs/d3/轴/5.png')" alt=""><br/>

:::warning
注意：`axisLeft`和`axisRight`时候坐标轴并没有展示完全，这是因为比例尺的原因，因为我们容器只有400高度，比例尺的范围是780，所以，轴就会超出。
:::

### axis.scale
这是另一种创建方式，将创建好的轴指定比例
```js
mySvg.append("g").call(d3.axisBottom().scale(xScale)).attr("transform", `translate(0,80)`);
```
<img :src="$withBase('/imgs/d3/轴/6.png')" alt=""><br/>

### axis.ticks
用于*建议*坐标轴的分段数量，实际结果是由比例尺的定义域以及传入的参数和刻度生成算法共同决定的。参数本质是除数而非固定的段数，传入的值会被视为建议的除数。

D3 强制刻度间隔为 1、2、5 或其 10 的整数倍（如 10、20、50）。若计算结果不符合（如间隔为 3 或 8），则自动优化至最接近的有效值。
```js
  const xScale = d3.scaleLinear().domain([0,100]).range([20,700])
  const xAxis = d3.axisBottom().scale(xScale)
  xAxis.ticks(8)
```
比如上图，定义的区间是0-100，分8份，间隔是12.5，无效，因此采用距离12.5最近的10，所以生成了10分，11个刻度
:::warning
注意：定义域的上限无法被刻度间隔整除时，末端刻度可能不显示
:::
```js
  const xScale = d3.scaleLinear().domain([0,360]).range([20,700])
  const xAxis = d3.axisBottom().scale(xScale)
  xAxis.ticks(5)
  mySvg.append("g").call(xAxis).attr("transform", "translate(0, 20)")
```
<img :src="$withBase('/imgs/d3/轴/7.png')" alt=""><br/>

:::warning
注意：`ticks`和比例尺的类型也息息相关，比如对于时间比例尺`d3.scaleTime`，需要搭配时间间隔函数比如`d3.timeDay.every(7)`生成刻度。比如序数比例尺`d3.scaleBand`,`ticks`是无效的需要使用`tickValues()`手动指定离散值。
:::

__手动生成刻度__
当默认逻辑不满足的时候，可以跳过`xAxis.ticks`直接调用比例尺方法
```js
const xScale = d3.scaleLinear().domain([0, 1]).range([20, 700])
const customTicks = xScale.ticks(5).filter(d => d*100 % 25 === 0)
const xAxis = d3.axisBottom().scale(xScale)
xAxis.tickValues(customTicks)
mySvg.append("g").call(xAxis).attr("transform", "translate(20, 20)")
```
<img :src="$withBase('/imgs/d3/轴/8.png')" alt=""><br/>

__更改坐标轴相关样式__
如图所示相关属性在图片上的展示
```js
  const xScale = d3.scaleLinear().domain([0, 1]).range([20, 700])
  const xAxis = d3.axisBottom().scale(xScale)
  xAxis.ticks(10)
  xAxis.tickSizeOuter(40)
  xAxis.tickSizeInner(20)
  xAxis.tickPadding(10)
  xAxis.tickFormat(d3.format(".0%"));
  mySvg.append("g").call(xAxis).attr("transform", "translate(20, 20)")
```
```css
.domain {
  stroke: blue;
  /* 坐标轴线颜色 */
  stroke-width: 4px;
}

.tick line {
  stroke: red;
  /* 刻度线颜色 */
  stroke-width: 2px;
}

.tick text {
  font-size: 12px;
  fill: darkgoldenrod;
  transform: rotate(30deg);
  font-weight: bold;
}
```
这些样式名都是默认生成的，查看dom可以得到，当然也可以自己调用`attr`方法添加
<img :src="$withBase('/imgs/d3/轴/9.png')" alt=""><br/>

### axis.tickArguments
`.tickArguments()`是坐标轴生成器（如 d3.axisBottom ）的方法，用于直接控制刻度生成参数，这些参数会被传递给底层比例尺的 `scale.ticks()`和`scale.tickFormat()`方法。
__基本用法__
这个方法和ticks一样，和比例尺的类型有关，还是以基础的线性比例尺为例
```js
const xScale = d3.scaleLinear().domain([0, 1]).range([20, 700])
const xAxis = d3.axisBottom().scale(xScale)
xAxis.tickArguments([5, '.0%'])
mySvg.append("g").call(xAxis).attr("transform", "translate(20, 20)")
```
其中`xAxis.tickArguments([5, '.0%'])`等同于`xAxis.ticks(5).tickFormat(d3.format(".0%"))`
就像`ticks`一样，不同类型的比例尺兼容性也不一样。后续在比例尺篇章详细讲解

### axis.tickValues
`.tickValues()`用于完全覆盖坐标轴的默认刻度生成逻辑，直接指定需要显示的刻度值数组。与建议性的`.ticks()`不同，此方法强制坐标轴仅渲染用户定义的刻度位置。无视比例尺的定义域分布和自动优化算法，支持所有比例尺类型（线性、时间、序数），优先级最高.

`tickValues`参数只能是数组或者null,如果是数组，数组元素需要包含在范围内，如果是null则默认刻度逻辑。
```js
const xScale = d3.scaleLinear().domain([0, 100]).range([20, 700])
const xAxis = d3.axisBottom().scale(xScale)
xAxis.tickValues([0,30,60,90,100])
```
<img :src="$withBase('/imgs/d3/轴/10.png')" alt=""><br/>
这种方式能够更好的满足在一些特殊情况下的坐标系统
:::warning
注意：如果传入的刻度值超出了定义域，就是指不在`domain`的范围内，该刻度就不会显示
:::

```js
const xScale = d3.scaleLinear().domain([0, 100]).range([20, 700])
const xAxis = d3.axisBottom().scale(xScale)
xAxis.tickValues([-30,30,60,90,100])
```
<img :src="$withBase('/imgs/d3/轴/11.png')" alt=""><br/>

:::warning
注意：传入空数组 [] 会隐藏所有刻度（保留坐标轴线）：
:::

```js
const xScale = d3.scaleLinear().domain([0, 100]).range([20, 700])
const xAxis = d3.axisBottom().scale(xScale)
xAxis.tickValues([])
```
<img :src="$withBase('/imgs/d3/轴/12.png')" alt=""><br/>

:::tip
何时选择
| 场景 | 推荐方法
| -- | -- |
| 需精确控制刻度位置 | ✅`.tickValues()`|
| 序数比例尺的刻度显示 | ✅`.tickValues()`（唯一方案）|
| 接受动态优化刻度数 | ⚠️优先 `.ticks()`|
| 时间轴按固定间隔显示 | ⚠️优先 `ticks(d3.timeDay.every(7))`|
:::

### axis.tickFormat()
tickFormat 是 D3.js 坐标轴（d3.axis）的核心方法之一，用于完全自定义刻度标签的显示内容。与ticks()控制刻度位置不同，
tickFormat专注于文本内容的精确控制，支持动态逻辑、多语言格式和复杂渲染。接受的参数是一个方法，三个传参分别是d（当前刻度值）i（刻度索引）values（所有刻度值数组）。由此配合`d3.format`就可以实现好多格式化

